<!--
 https://github.com/stevenrskelton/d3-datamaps
-->

<script src="js/d3/d3.v3.min.js"></script>
<script src="js/topojson/topojson.v1.min.js"></script>
<script src="js/datamaps/datamaps.js"></script>

<polymer-element name="d3-datamaps" attributes="selected hover clicked">
  <template>
    <style>
      #container {
		position:relative;
		background-color: #56A5EC;
      }
    </style>
    <div id="container" style="cursor:crosshair;"></div>
  </template>
  <script>
	//https://github.com/markmarkoh/datamaps/blob/master/README.md#getting-started
	Polymer('d3-datamaps', {
		map: null,
		width: 425,
		hover: null,
		attached: function(){
			var self = this;
			this.$.container.style.height = (this.$.container.scrollWidth*0.5) + 'px';
			this.map = new Datamap({element: this.$.container,
			fills: {
				defaultFill: '#ABDDA4'
			},
			data: {},
			geographyConfig: {
				dataUrl: '../src/js/datamaps/world.topo.json', //if not null, datamaps will fetch the map JSON (currently only supports topojson)
				hideAntarctica: false,
				borderWidth: 1,
				borderColor: '#99C68E',
				popupTemplate: function(geography, data) { //this function should just return a string
					if(!self.hover || self.hover.id != geography.id) self.hover = geography;
					//if(c.indexOf(geography.id)>-1){
					return '<div class="hoverinfo"><strong>' + geography.properties.name + '</strong></div>';
					//}else{
					//  return '';
					//}
				},
				popupOffHover: function(){
					self.hover = null;
				},
				userClick: function(geography){
					self.fire('clicked', geography);
				},
				popupOnHover: true, //disable the popup while hovering
				highlightOnHover: true,
				highlightFillColor: '#F0F033',
				highlightBorderColor: '#DDDD33',
				highlightBorderWidth: 1
			}
			});
		},
		selectedChanged: function(oldVal, newVal) {
			var cleared = { color: '#ABDDA4' };
			var selectedToFill = {};

			//clear old
			if(oldVal){
				for (var key in oldVal) {
					if (oldVal.hasOwnProperty(key)) {
						selectedToFill[key] = cleared;
					}
				}
			}

			//fill new
			if(newVal){
				for (var key in newVal) {
					if (newVal.hasOwnProperty(key)) {
						if(typeof newVal[key] === 'string'){
							selectedToFill[key] = { color: newVal[key] };
						}else{
							selectedToFill[key] = newVal[key];
						}
					}
				}
			}

			if(this.map) this.map.updateChoropleth(selectedToFill);
		}
	});
  </script>    
</polymer-element>